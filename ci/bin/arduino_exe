#!/bin/bash

if [ "$(type -t os)" != "function" ]
then
    . "$(cd "$(dirname "${BASH_SOURCE[0]}")"; pwd)"/os
fi

if [ "$(type -t version)" != "function" ]
then
    . "$(cd "$(dirname "${BASH_SOURCE[0]}")"; pwd)"/version
fi

if [ "$(type -t dir_cache)" != "function" ]
then
    . "$(cd "$(dirname "${BASH_SOURCE[0]}")"; pwd)"/dir_cache
fi

arduino_exe() {
    if [ "$ARDUINO_EXE" != "" ]
    then
        echo "$ARDUINO_EXE"
        return
    fi
    OS="$(os "$@")"
    VERSION="$(version "$@")"    
    DIR_CACHE="$(dir_cache "$@")"

    if [ "$OS" = "macosx" ]
    then
	echo "${DIR_CACHE}/Arduino.app/Contents/MacOS/Arduino"
    elif [ "$OS" = "windows" ]
    then
	echo "${DIR_CACHE}/arduino-${VERSION}/arduino.exe"
    else
        echo "${DIR_CACHE}/arduino-${VERSION}/arduino"
    fi
}

if [[ "${BASH_SOURCE[0]}" == "${0}" ]]
then
    arduino_exe "$@"
fi
